!function(){"use strict";class FrameworkCore{static#e=null;constructor(){if(FrameworkCore.#e)return FrameworkCore.#e;this.start(),this.setupObjectExtension(),this.setupNumberExtension(),this.setupStringExtension(),this.setupErrorExtension(),this.setupOtherExtension(),Object.freeze(this),FrameworkCore.#e=this,Object.freeze(FrameworkCore)}start(){Object.defineProperty(FrameworkCore,"defineProperty",{value:function(e,t,r,n={}){if(null===e)throw new TypeError("Target cannot be null or undefined.");if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be an object or function.");if("string"!=typeof t&&"symbol"!=typeof t)throw new TypeError("Property key must be a string or symbol.");return Object.defineProperty(e,t,{writable:!1,enumerable:!1,configurable:!1,...n,value:r}),!0},writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(Object,"freezeProp",{value:function(e,t,r){return FrameworkCore.defineProperty(e,t,r)},writable:!1,enumerable:!1,configurable:!1}),Object.freezeProp(Object,"sealProp",function(e,t,r){return FrameworkCore.defineProperty(e,t,r,{writable:!0})}),Object.freezeProp(FrameworkCore,"toString",Object.prototype.toString),Object.freezeProp(Object,"typeOf",function(e){return void 0===e?"undefined":null===e?"null":FrameworkCore.toString.call(e).replace(/^\[object (\S+)\]$/,"$1").toLowerCase()}),Object.freezeProp(Object,"isObject",function(e){return"[object Object]"===FrameworkCore.toString.call(e)}),Object.freezeProp(Object,"hasPrototype",function(e){return null!==e&&"object"==typeof e&&(null!==Object.getPrototypeOf(e)&&"object"==typeof Object.getPrototypeOf(e))}),Object.freezeProp(Object,"pure",function(e=null,t=!0){return Object.isObject(e)?Object.hasPrototype(e)?!0===t?Object.assign(Object.create(null),e):Object.setPrototypeOf(e,null):e:Object.create(null)})}setupObjectExtension(){Object.freezeProp(Object,"getConstructorOf",function(e){if(!Object.hasPrototype(e))throw new TypeError("Object prototype is null.");const t=Object.getPrototypeOf(e);if(!Object.hasOwn(t,"constructor")||"function"!=typeof t.constructor)throw new TypeError("Constructor is invalid.");return t.constructor}),Object.freezeProp(Object,"isClassInstance",function(e,t){if("string"!=typeof t)return!1;if(!Object.hasPrototype(e))return!1;const r=Object.getPrototypeOf(e);return!(!Object.hasOwn(r,"constructor")||!Object.hasOwn(r.constructor,"name")||r.constructor.name!==t)}),Object.freezeProp(Object,"isElement",function(e){return e instanceof HTMLElement})}setupNumberExtension(){Object.freezeProp(Number,"isNumber",function(e){return!("number"!=typeof e||!Number.isFinite(e))})}setupStringExtension(){Object.freezeProp(String,"isNullOrEmpty",function(e){return null==e||"string"!=typeof e||0===e.length}),Object.freezeProp(String,"NON_WHITESPACE_REGEX",/\S/),Object.freezeProp(String,"isNullOrWhiteSpace",function(e){return!!String.isNullOrEmpty(e)||!String.NON_WHITESPACE_REGEX.test(e)}),Object.freezeProp(String,"isNumberOrString",function(e){return!(!Number.isNumber(e)&&String.isNullOrEmpty(e))})}setupErrorExtension(){Object.freezeProp(Error,"throwIfNull",function(e,t=null){if(void 0===e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} is required.`);if(null===e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} cannot be null.`);return!0}),Object.freezeProp(Error,"throwIfNotString",function(e,t=null){if(Error.throwIfNull(e,t),"string"!=typeof e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of string type.`);return!0}),Object.freezeProp(Error,"throwIfEmpty",function(e,t=null){if(Error.throwIfNotString(e,t),0===e.length)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} cannot be empty.`);return!0}),Object.freezeProp(Error,"throwIfWhiteSpace",function(e,t=null){if(Error.throwIfNotString(e,t),!String.NON_WHITESPACE_REGEX.test(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} cannot be empty or whitespace.`);return!0}),Object.freezeProp(Error,"throwIfNotObject",function(e,t=null){if(!Object.isObject(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of object type.`);return!0}),Object.freezeProp(Error,"throwIfNotFunction",function(e,t=null){if("function"!=typeof e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of function type.`);return!0}),Object.freezeProp(Error,"throwIfNotNumber",function(e,t=null){if("number"!=typeof e||!Number.isFinite(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of number type.`);return!0}),Object.freezeProp(Error,"throwIfNotArray",function(e,t=null){if(!Array.isArray(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of array type.`);return!0}),Object.freezeProp(Error,"throwIfNotElement",function(e,t=null){if("undefined"==typeof HTMLElement)throw new Error("DOM API is not available in this environment.");if(!(e instanceof HTMLElement))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be a HTML element.`);return!0})}setupOtherExtension(){Object.freezeProp(String,"toNotEmptyString",function(e,t=null,r=null){return Number.isNumber(e)&&(e+=""),String.isNumberOrString(r)&&String.isNullOrWhiteSpace(e)?(Number.isNumber(r)&&(r+=""),Error.throwIfWhiteSpace(r,"Default value"),r):(Error.throwIfWhiteSpace(e,t),e.trim())}),Object.freezeProp(URL,"create",function(e,t=null){return e=String.toNotEmptyString(e,"URL"),null==t?t=Object.hasOwn(self,"app")&&self.app.configuration.has("base")?self.app.configuration.get("base"):location.origin:Error.throwIfWhiteSpace(t,"baseUrl"),new URL(e,t)}),Object.freezeProp(Element,"create",function(e="div",t="",r=null){e=String.toNotEmptyString(e,"Tag name","div");const n=document.createElement(e);if(Object.isObject(r)){for(const[e,t]of Object.entries(r))n.setAttribute(e,t||"");r=null}return t&&(n.textContent=t),n}),Object.freezeProp(Element,"createAll",function(e){if(Object.isObject(e)){const t=Element.create(e.tag,e.text,e.attrs);if(Array.isArray(e.children)&&e.children.length>0)for(const r of e.children)Object.isObject(r)&&t.append(Element.createAll(r));return t}return document.createElement("div")})}}class DataBase{#t=null;constructor(e=null){Object.isObject(e)?this.#t=Object.pure(e):this.#t=Object.pure(),Object.freeze(this)}get length(){return Object.keys(this.#t).length}has(e){return Object.hasOwn(this.#t,e)}set(e,t){return e=String.toNotEmptyString(e,"Key"),this.#t[e]=t,this}get(e){return this.has(e)?this.#t[e]:null}keys(){return Object.keys(this.#t)}entries(){return Object.entries(this.#t)}delete(e){return this.has(e)&&delete this.#t[e],this}clear(){for(const e of Object.keys(this.#t))delete this.#t[e];return!0}}class Configuration extends DataBase{constructor(e=null){if(Object.isObject(e))for(const t of Object.keys(e))Object.hasPrototype(e[t])&&Object.setPrototypeOf(e[t],null);super(e)}create(e=null){return new Configuration(e)}}class ServiceManager{static#e=null;constructor(){if(ServiceManager.#e)return ServiceManager.#e;Object.freezeProp(ServiceManager,"services",new Map),Object.freezeProp(ServiceManager,"singletons",new Map),Object.freeze(this),ServiceManager.#e=this,Object.freeze(ServiceManager)}#r(e){const t=e.dependency.map(e=>this.get(e));return new e.constructor(...t)}serviceNames(){return Array.from(ServiceManager.services.keys())}has(e){return ServiceManager.services.has(e)}get(e){if(!this.has(e))throw new Error(`The "${e}" service is not registered.`);const t=ServiceManager.services.get(e);return t.singleton?(ServiceManager.singletons.has(e)||ServiceManager.singletons.set(e,this.#r(t)),ServiceManager.singletons.get(e)):this.#r(t)}register(e,t,r={}){if(e=String.toNotEmptyString(e,"Service name"),this.has(e))throw new Error(`The "${e}" service has already been registered.`);if("function"!=typeof t)throw new Error(`The "${e}" service to be registered is invalid.`);Error.throwIfNotObject(r,"Service options");const n={singleton:!1,dependency:[],...r};return ServiceManager.services.set(e,{constructor:t,...n}),this}addSingleton(e,t,r=[]){return this.register(e,t,{singleton:!0,dependency:r})}addTransient(e,t,r=[]){return this.register(e,t,{singleton:!1,dependency:r})}destroy(){ServiceManager.singletons.forEach(e=>{"function"==typeof e.destroy&&e.destroy()}),ServiceManager.services.clear(),ServiceManager.singletons.clear()}}class ApplicationBuilder{static#e=null;#n=null;#i;#o;#s;#a=[];constructor(){if(ApplicationBuilder.#e)return ApplicationBuilder.#e;new FrameworkCore,this.#c(),ApplicationBuilder.#e=this}#c(){this.#i=new Configuration,this.#o=new ServiceManager,this.#n=new Application(this.#i,this.#o,this.#s),this.#i.set("base",location.origin),this.#i.set("environment",window.isSecureContext&&"http:"===location.protocol?"development":"production"),this.#i.set("framework",Object.pure({name:"webcore",version:"1.0.0"}))}setConfig(e,t){return this.#i.set(e,t),this}addService(e){Error.throwIfNotObject(e,"Registration service configuration"),!0===e.singleton?this.#o.addSingleton(e.name,e.service,e.dependency):this.#o.addTransient(e.name,e.service,e.dependency),!0===e.global&&Object.freezeProp(this.#n,e.name,this.#o.get(e.name))}addSingleton(e,t,r){return this.#o.addSingleton(e,t,r),this.#a.push(e),this}addTransient(e,t,r){return this.#o.addTransient(e,t,r),this.#a.push(e),this}build(){return Object.freeze(this.#n),this.#n}}class Application{static#e=null;constructor(e,t,r){if(Application.#e)return Application.#e;Object.freezeProp(this,"configuration",e),Object.freezeProp(Application,"services",t),Object.freeze(Application),Application.#e=this}static createBuilder(){return new ApplicationBuilder}getConfig(e){return this.configuration.get(e)}setConfig(e,t){return this.configuration.set(e,t)}getService(e){return Application.services.get(e)}hasService(e){return Application.services.has(e)}serviceNames(){return Application.services.serviceNames()}async loader(e){e=URL.create(e);try{const t=await fetch(e);return await t.text()}catch(t){throw t}}run(){Object.hasOwn(this,"initial")&&this.initial.execute(),delete Object.getPrototypeOf(this).run}}class RouterService{static#e=null;constructor(){if(RouterService.#e)return RouterService.#e;top.history.replaceState(!0,null,location.origin+location.pathname),Object.freezeProp(RouterService,"handlers",Object.pure());const e=RouterService.handlers;e.top=e=>{e.preventDefault(),top.location.replace(e.currentTarget.dataset.href)},e.parent=e=>{e.preventDefault(),parent.location.replace(e.currentTarget.dataset.href)},e.blank=e=>{e.preventDefault(),self.open(e.currentTarget.dataset.href,"_blank")},e.assign=e=>{e.preventDefault(),location.assign(e.currentTarget.dataset.href)},e.replace=e=>{e.preventDefault(),location.replace(e.currentTarget.dataset.href)},document.documentElement.classList.contains("webcore")&&top.addEventListener("DOMContentLoaded",()=>{this.init(),this.anchor(document.body)},{once:!0}),Object.freeze(this),RouterService.#e=this,Object.freeze(RouterService)}init(){RouterService.handlers.frames=Object.pure();const e=top.frames.length;for(let t=0;t<e;t++){const e=Object.pure();e.frame=top.frames[t],e.assign=t=>{t.preventDefault(),e.frame.location.assign(t.currentTarget.dataset.href)},e.replace=t=>{t.preventDefault(),e.frame.location.replace(t.currentTarget.dataset.href)};const r=top.frames[t].name||"view";RouterService.handlers.frames[r]=e}}anchor(e){return e instanceof HTMLElement&&(0==e.childElementCount&&(e=e.parentElement),e.querySelectorAll("a[data-href]").forEach(e=>{const t=!!e.hasAttribute("data-target")&&e.dataset.target.trim(),r=!!e.hasAttribute("data-iframe")&&e.dataset.iframe.trim();if(t){if("top"===t)return e.onclick=RouterService.handlers.top,!0;if("parent"===t)return e.onclick=RouterService.handlers.parent,!0;if("blank"===t)return e.onclick=RouterService.handlers.blank,!0}return r&&Object.hasOwn(RouterService.handlers.frames,r)?t&&"self"===t?(e.onclick=RouterService.handlers.frames[r].replace,!0):(e.onclick=RouterService.handlers.frames[r].assign,!0):t&&"self"===t?(e.onclick=RouterService.handlers.replace,!0):(e.onclick=RouterService.handlers.assign,!0)}),!0)}}class GlobalData extends DataBase{constructor(e=null){super(e)}}class GlobalService{static#e=null;constructor(){if(GlobalService.#e)return GlobalService.#e;Object.freezeProp(this,"system",new GlobalData),Object.freezeProp(this,"vars",new GlobalData),Object.freezeProp(this,"state",new GlobalData),this.start(),Object.freeze(this),GlobalService.#e=this,Object.freeze(GlobalService)}start(){}}class OrientationChange{static#e=null;constructor(){if(OrientationChange.#e)return OrientationChange.#e;Object.freezeProp(OrientationChange,"tasks",[]),Object.sealProp(OrientationChange,"running",!1),Object.freeze(this),OrientationChange.#e=this}get running(){return OrientationChange.running}get length(){return OrientationChange.tasks.length}add(e){return this.running||"function"!=typeof e||(this.remove(e),OrientationChange.tasks.push(e)),this}has(e){return"function"==typeof e&&-1!==OrientationChange.tasks.indexOf(e)}async execute(){if(this.running)return!1;OrientationChange.running=!0;for(const t of OrientationChange.tasks)try{await Promise.resolve(t())}catch(e){}return OrientationChange.running=!1,!0}remove(e){if(!this.running&&"function"==typeof e){const t=OrientationChange.tasks.indexOf(e);if(-1!==t)return OrientationChange.tasks.splice(t,1),!0}return!1}removeAt(e){return!this.running&&"number"==typeof e&&(!(e<0||e>this.length)&&(OrientationChange.tasks.splice(e,1),!0))}clear(){return OrientationChange.tasks=[],this}}class Orientation{static#e=null;constructor(){if(Orientation.#e)return Orientation.#e;Object.freezeProp(this,"change",new OrientationChange),Object.freezeProp(Orientation,"media",top.matchMedia("(orientation: landscape)")),Orientation.media.onchange=()=>{this.change.execute()};const e=()=>{Orientation.media.matches?document.documentElement.classList.remove("portrait"):document.documentElement.classList.add("portrait")},t=screen.orientation;(document.documentElement.classList.contains("dync")||t.type.startsWith("p")&&(90==t.angle||270==t.angle)||t.type.startsWith("l")&&(0==t.angle||180==t.angle))&&this.change.add(e),e(),Object.freeze(this),Orientation.#e=this}get landscape(){return Orientation.media.matches}get portrait(){return!Orientation.media.matches}get matches(){return Orientation.media.matches?"landscape":"portrait"}destroy(){Orientation.media.onchange=null,this.change.clear(),Orientation.#e=null}}class LayoutService{static#e=null;constructor(){if(LayoutService.#e)return LayoutService.#e;Object.freezeProp(this,"orientation",new Orientation),Object.sealProp(LayoutService,"executed",!1),this.start(),LayoutService.executed=!0,LayoutService.#e=this,Object.freeze(LayoutService)}get landscape(){return this.orientation.landscape}get portrait(){return this.orientation.portrait}get fontSize(){return parseFloat(getComputedStyle(document.documentElement).getPropertyValue("font-size"))}start(){if(LayoutService.executed)return!1;const e=document.documentElement;return this.setupFontScaling(e),this.setupUserExperience(e),!0}setupFontScaling(e){if(e.classList.contains("dync"))return!1;e.style.fontSize="11.55pt";const t=screen.orientation,r={base:28.57,initial:parseFloat(getComputedStyle(e).getPropertyValue("font-size"))||15.4};e.removeAttribute("style");const n=()=>{0==t.angle||180==t.angle?e.classList.add("portrait"):e.classList.remove("portrait")},i=()=>{0==t.angle||180==t.angle?(e.style.fontSize=r.portrait,e.classList.add("portrait")):(e.style.fontSize=r.landscape,e.classList.remove("portrait"))},o=screen.width/r.initial<r.base||screen.height/r.initial<r.base;return!t.type.startsWith("p")||0!=t.angle&&180!=t.angle?!t.type.startsWith("l")||90!=t.angle&&270!=t.angle||(o?top.innerWidth>screen.width?(r.portrait=top.innerWidth/r.base+"px",r.landscape=top.innerWidth/screen.width*(screen.height/r.base)+"px",e.style.fontSize=r.landscape,t.onchange=i):(r.portrait=screen.height/r.base+"px",e.style.fontSize=r.portrait,t.onchange=n):t.onchange=n):(e.classList.add("portrait"),o?(r.portrait=top.innerWidth/r.base+"px",e.style.fontSize=r.portrait,top.innerWidth>screen.width?(r.landscape=top.innerWidth/screen.height*(screen.width/r.base)+"px",t.onchange=i):t.onchange=n):t.onchange=n),!0}setupUserExperience(e){e.classList.contains("ban")&&(e.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1));const t=function(){};return document.addEventListener("touchstart",t,{passive:!0}),window.onbeforeunload=()=>{document.removeEventListener("touchstart",t)},!0}}class EventBuilder{#l=null;#u=Object.pure();#h=Object.pure();constructor(e){Error.throwIfNotElement(e,"Event target"),this.#l=e,Object.freeze(this)}get element(){return this.#l}get handlers(){return this.#u}get options(){return this.#h}on(e,t,r=null){return Error.throwIfWhiteSpace(e,"Event name"),Error.throwIfNotFunction(t,"Event handler"),e=e.trim(),this.#u[e]=t,this.options[e]=Object.isObject(r)?r:Object.pure(),this}bind(){return Error.throwIfNull(EventBuilder.EventService,"Event service instance"),EventBuilder.EventService.register(this),this}once(e,t,r=null){return Object.isObject(r)||(r=Object.pure()),r.once=!0,this.on(e,t,r)}click(e,t){return this.on("click",e,t)}pointerdown(e,t){return this.on("pointerdown",e,t)}pointerup(e,t){return this.on("pointerup",e,t)}submit(e,t){return this.on("submit",e,t)}reset(e,t){return this.on("reset",e,t)}invalid(e,t){return this.on("invalid",e,t)}resize(e,t){return this.on("resize",e,t)}scroll(e,t){return this.on("scroll",e,t)}focus(e,t){return this.on("focus",e,t)}blur(e,t){return this.on("blur",e,t)}change(e,t){return this.on("change",e,t)}input(e,t){return this.on("input",e,t)}keydown(e,t){return this.on("keydown",e,t)}toggle(e,t){return this.on("toggle",e,t)}show(e,t){return this.on("show",e,t)}open(e,t){return this.on("open",e,t)}close(e,t){return this.on("close",e,t)}error(e,t){return this.on("error",e,t)}message(e,t){return this.on("message",e,t)}dblclick(e,t){return this.on("dblclick",e,t)}contextmenu(e,t){return this.on("contextmenu",e,t)}hover(e,t,r){return this.on("mouseenter",e,r),this.on("mouseleave",t,r),this}}class EventProvider{constructor(){if(EventProvider.instance)return EventProvider.instance;Object.freezeProp(EventProvider,"events",new Map),Object.freeze(this),Object.freezeProp(EventProvider,"instance",this)}expose(e,t={}){return e=String.toNotEmptyString(e,"Provider"),!!Object.isObject(t)&&(EventProvider.events.delete(e),EventProvider.events.set(e,Object.pure(t,!1)),!0)}has(e,t=null){return e=String.toNotEmptyString(e,"Provider"),!!EventProvider.events.has(e)&&(!!String.isNullOrWhiteSpace(t)||Object.hasOwn(EventProvider.events.get(e),t.trim()))}use(e,t=null){if(e=String.toNotEmptyString(e,"Provider"),this.has(e)){const r=EventProvider.events.get(e);if(Object.isObject(r)){if(String.isNullOrWhiteSpace(t))return r;if(t=t.trim(),Object.hasOwn(r,t))return r[t]}}return null}delete(e){return e=String.toNotEmptyString(e,"Provider"),EventProvider.events.delete(e),this}clear(){return EventProvider.events.clear(),!0}}class EventService{constructor(){if(EventService.instance)return EventService.instance;Object.sealProp(EventService,"handlers",new WeakMap),Object.freezeProp(EventProvider,"provider",new EventProvider),Object.freezeProp(EventService,"invoke",function(e){const t=e.type;let r=null;if(this.instance.has(e.currentTarget,t)?r=EventService.handlers.get(e.currentTarget)[t]:this.instance.has(e.target,t)&&(r=EventService.handlers.get(e.target)[t]),"function"==typeof r)try{return r(e)}catch(n){return!1}return!1}),Object.freezeProp(EventService,"handler",e=>EventService.invoke(e)),Object.freezeProp(EventBuilder,"EventService",this),Object.freeze(EventBuilder),Object.freeze(this),Object.freezeProp(EventService,"instance",this)}expose(e,t){return EventProvider.provider.expose(e,t)}use(e,t){return EventProvider.provider.use(e,t)}delete(e){return EventProvider.provider.delete(e)}select(e){if(Object.isElement(e))return new EventBuilder(e);if(Object.isClassInstance(e,"ReactiveElement"))return new EventBuilder(e.element);throw new ReferenceError("Invalid element.")}register(e){try{if(e instanceof EventBuilder){EventService.handlers.set(e.element,e.handlers);for(const t of Object.keys(e.handlers))e.element.addEventListener(t,EventService.handler,e.options[t])}}catch(t){return!1}}has(e,t){return!String.isNullOrWhiteSpace(t)&&("string"==typeof e?EventProvider.provider.has(e,t):e instanceof HTMLElement&&(!!EventService.handlers.has(e)&&Object.hasOwn(EventService.handlers.get(e),t.trim())))}emit(e,t,...r){if(!this.has(e,t))return!1;let n=null;n="string"==typeof e?EventProvider.provider.use(e,t):EventService.handlers.get(e)[t.trim()];try{if("function"==typeof n)return n(...r)}catch(i){return!1}return!1}remove(e,t=null){if(this.has(e)){let r=EventService.handlers.get(e);if("string"==typeof t){if(!Object.hasOwn(r,t))return this;r[t]=null,delete r[t],e.removeEventListener(t,EventService.handler),0===Object.keys(r).length&&EventService.handlers.delete(e)}else{for(const t of Object.keys(r))r[t]=null,e.removeEventListener(t,EventService.handler);r=null,EventService.handlers.delete(e)}}return this}destroy(){return EventService.handlers=new WeakMap,EventProvider.provider.clear(),!0}target(e,t,r=10){if(!(e instanceof Event))return null;if(!e.target||!e.currentTarget)return null;let n=e.target;const i=e.currentTarget;if("string"!=typeof t)return n;if(!(t=t.trim().toUpperCase()))return n;if(n===i)return i.nodeName===t?n:null;if("string"==typeof t){let e=0;for(;e<r&&n!=i;){if(n.nodeName===t)return n;if(!n.parentElement)return null;n=n.parentElement,e++}}return null}debounce(e,t=300,r=!1){let n=null;return function(...i){const o=this;n&&clearTimeout(n),r&&!n&&e.apply(o,i),n=setTimeout(()=>{n=null,r||e.apply(o,i)},t)}}throttle(e,t=300,r=!0){let n=null,i=0;return function(...o){const s=this,a=Date.now(),c=t-(a-i);n&&(clearTimeout(n),n=null),c<=0?(e.apply(s,o),i=a):r&&!n&&(n=setTimeout(()=>{e.apply(s,o),i=Date.now(),n=null},c))}}}class CacheEntry{#h=null;#p=null;#f=null;#d=0;#g=null;#v=null;#b=null;constructor(e=null,t=null,r=null,n=null){Error.throwIfWhiteSpace(e,"key");const i=Date.now();if(this.#v=i,this.#b=i,this.#p=e,this.#f=t,this.#g=n,this.#h=Object.pure({sliding:0,absolute:0},!1),Object.isObject(r))for(const o of Object.keys(this.#h))Object.hasOwn(r,o)&&"number"==typeof r[o]&&(this.#h[o]=r[o]);this.#h.sliding>0&&(this.#d=i+1e3*this.#h.sliding),this.#h.absolute>0&&(this.#d=i+1e3*this.#h.absolute),Object.seal(this)}get key(){return this.#p}get value(){const e=Date.now();return this.#h.sliding>0&&(this.#d=e+1e3*this.#h.sliding),this.#b=e,this.#f}get handler(){const e=this.#g;return this.#g=null,e}get expired(){return this.#d>0&&Date.now()>this.#d&&(this.#f=null,!0)}}class StateService extends DataBase{static#e=null;constructor(){if(super(),StateService.#e)return StateService.#e;Object.freeze(this),StateService.#e=this}}class ReactiveElement{#l=null;#f="";#m=null;constructor(e,t=null){e instanceof HTMLElement?this.#l=e:this.#l=document.createElement("div"),"string"==typeof t?(this.#l.textContent=t,this.#f=t):this.#f=this.#l.textContent,Object.freeze(this)}get element(){return this.#l}get value(){return this.#f}set value(e){"function"==typeof this.#m&&this.#f!==e&&this.#m(e,this.#f,this.#l),this.#f=e,this.#l.textContent=e}set onchange(e){Error.throwIfNotFunction(e,"Change callback"),this.#m=e}mount(e){if("string"==typeof e){const t=document.querySelector(e);t&&t.append(this.#l)}else e instanceof HTMLElement&&e.append(this.#l);return this}unmount(){return this.#l.remove(),this}}class ReactiveStore{#O=null;constructor(e=null){const t=Object.pure();t.value=e,this.#O=new Proxy(t,{get:(e,t)=>e.value,set:(e,t,r)=>("function"==typeof this.onchange&&this.onchange(r,e.value),e.value=r,!0)}),Object.freeze(this)}get value(){return this.#O.value}set value(e){this.#O.value=e}}class ReactiveService{static#e=null;constructor(){if(ReactiveService.#e)return ReactiveService.#e;Object.freeze(ReactiveElement),Object.freeze(ReactiveStore),ReactiveService.#e=this}element(e="div",t){if(e instanceof HTMLElement)return new ReactiveElement(e,t);try{"string"!=typeof e&&(e="div");const r=document.createElement(e);return new ReactiveElement(r,t)}catch{return new ReactiveElement(document.createElement("div"),t)}}store(e){return new ReactiveStore(e)}}class StorageService{static#e=null;constructor(){if(StorageService.#e)return StorageService.#e;Object.freezeProp(Map.prototype,"toObject",function(){const e=Object.pure();for(const[t,r]of this.entries())("string"==typeof t||"number"==typeof t&&Number.isFinite(t))&&(e[t]=r);return e}),Object.freezeProp(Map.prototype,"toJSON",function(){return this.toObject()}),Object.freezeProp(Set.prototype,"toArray",function(){return Array.from(this)}),Object.freezeProp(Set.prototype,"toJSON",function(){return this.toArray()}),Object.freezeProp(StorageService,"validateKey",function(e){if("string"!=typeof e&&"number"!=typeof e)throw new TypeError("Key must be string or number.");if("number"==typeof e&&(e=e.toString()),String.isNullOrWhiteSpace(e))throw new TypeError("Key cannot be empty.");return e.trim()}),StorageService.#e=this,Object.freeze(StorageService)}get length(){return localStorage.length}has(e){return e=StorageService.validateKey(e),null!==localStorage.getItem(e)}set(e,t){return e=StorageService.validateKey(e),null==t?(localStorage.removeItem(e),this):(localStorage.setItem(e,JSON.stringify(t)),this)}get(e,t=null){e=StorageService.validateKey(e);const r=localStorage.getItem(e);try{return null===r?t:JSON.parse(r)}catch(n){return r}}keys(){return Object.keys(localStorage)}entries(){const e=[];for(let r=0;r<localStorage.length;r++){const n=localStorage.key(r),i=localStorage.getItem(n);try{e.push([n,JSON.parse(i)])}catch(t){e.push([n,i])}}return e}delete(e){return e=StorageService.validateKey(e),localStorage.removeItem(e),this}clear(){return localStorage.clear(),this}}class Component{name=null;component=null;props=null;constructor(e,t){this.name=e,this.props=t.observedAttributes||null,this.component=t}createInstance(){return new this.component}getComponentClass(){return this.component}}class ComponentTemplate{#y=!0;#S=null;#E="<slot></slot>";get initial(){return this.#y}get html(){return this.#E}set html(e){this.#y&&!String.isNullOrWhiteSpace(e)&&(this.#E=ComponentTemplate.compress(e),this.#y=!1)}has(){return!String.isNullOrWhiteSpace(this.#E)}fragment(e=!1){return null==this.#S&&(this.#S=document.createRange().createContextualFragment(this.#E)),!0===e?this.#S.firstElementChild.cloneNode(!0):this.#S.firstElementChild}static compress(e){return e.replace(/\n\s*/g,"").replace(/>\s+</g,"><").trim()}}class ComponentStyles{#w=null;#j=null;#y=!0;#P=!1;#C=null;get initial(){return this.#y}get href(){return this.#w}get style(){return this.#j}set style(e){this.#y&&(e.endsWith(".css")?(this.#w=e,this.#y=!1):e.length>3&&(this.#j=ComponentStyles.compress(e),this.#y=!1))}async getStyleSheet(){if(null!==this.#w&&!this.#P)try{const e=await r.loader(this.#w);this.#j=ComponentStyles.compress(e),this.#P=!0}catch{throw new TypeError("Component style loading failed.")}if(!this.#y&&null==this.#C){const e=new CSSStyleSheet;e.replaceSync(this.#j),this.#C=[e]}return this.#C}static compress(e){return e.replace(/\n\s*/g,"").replace(/\s*{\s*/g,"{").replace(/\s*}\s*/g,"}").replace(/\s*:\s*/g,":").replace(/\s*;\s*/g,";").replace(/;\s*}/g,"}").trim()}}class ComponentBuilder extends HTMLElement{#N="core-element";#z="open";#T=[];#k=Object.pure();#M=Object.pure();#l=Object.pure();#x=null;#L=null;#A=null;#I=null;constructor(e=null){super(),this.#I=Object.getConstructorOf(this),this.#N=this.#I.tag,Object.hasOwn(this.#I,"template")||(this.#I.template=new ComponentTemplate),Object.hasOwn(this.#I,"styles")||(this.#I.styles=new ComponentStyles),Object.isObject(e)&&(this.#A=r.configuration.create(e)),Object.freeze(this.#I),this.create(),this.#r(),this.#W()}get root(){return this.#x}get shadow(){return this.#L}get services(){return this.#k}get element(){return this.#l}get config(){return this.#A}get state(){return this.#M}get props(){return this.#I.observedAttributes||null}get name(){return this.#N}template(e){return this.#I.template.html=e,this}styles(e){return this.#I.styles.style=e,this}mode(e="open"){if(!["open","closed"].includes(e))throw new TypeError('Shadow DOM mode must be either "open" or "closed"');return this.#z=e,this}inject(e){return Error.throwIfNotArray(e,"Component service inject"),this.#T=e,this}connectedCallback(){if("function"==typeof this.onConnected)return this.onConnected()}attributeChangedCallback(e,t,r){if("function"==typeof this.onAttributeChanged)return this.onAttributeChanged(e,r,t)}adoptedCallback(){if("function"==typeof this.onAdopted)return this.onAdopted()}disconnectedCallback(){if("function"==typeof this.onDisconnected)return this.onDisconnected()}selector(e){return this.#x.querySelector(e)}service(e){return Object.hasOwn(this.#k,e)?this.#k[e]:null}create(e){if("function"!=typeof e)throw new TypeError('"create" method must be implemented by subclass');return this}render(e){if("function"!=typeof e)throw new TypeError('"render" method must be implemented by subclass');return this}#r(){if(this.#L=this.attachShadow({mode:this.#z}),this.#I.template.has()&&(this.#x=this.#I.template.fragment(!0)),this.#T.length>0){this.#k=Object.pure();for(const e of this.#T)this.#k[e]=r.getService(e)}}async#W(){if(!this.#I.styles.initial){const e=await this.#I.styles.getStyleSheet();this.#L.adoptedStyleSheets=e}this.#L.appendChild(this.#x)}static check(e){return(e=String.toNotEmptyString(e,"Component tag name")).includes("-")||(e=`core-${e}`),e}}class ComponentService{static#e=null;#R=new Map;constructor(){if(ComponentService.#e)return ComponentService.#e;Object.freezeProp(this,"builder",ComponentBuilder),Object.freeze(this),ComponentService.#e=this}async load(e,t){e=URL.create(e);try{const r=(await import(e.href)).default;return this.register(r,t),r}catch{throw new Error("Component loading failed.")}}has(e){return e=ComponentBuilder.check(e),this.#R.has(e)}get(e){if(e=ComponentBuilder.check(e),!this.#R.has(e))throw new Error("Component not registered, please register first");return this.#R.get(e).createInstance()}getClass(e){if(e=ComponentBuilder.check(e),!this.#R.has(e))throw new Error("Component not registered, please register first");return this.#R.get(e).getComponentClass()}register(e,t){if(Object.getPrototypeOf(e)!==ComponentBuilder)throw new Error('The component is invalid and is not a "webcore" component.');if(String.isNullOrWhiteSpace(t)){if(String.isNullOrWhiteSpace(e.tag))throw new Error("Missing component tag name.");t=ComponentBuilder.check(e.tag)}else t=ComponentBuilder.check(t);if(this.#R.has(t))throw new Error(`Component "${t}" is already registered, skipping.`);try{customElements.define(t,e);const r=new Component(t,e);return this.#R.set(t,r),this}catch(r){throw new Error(`Failed to register component "${t}": ${r.message}.`)}}registerAll(e){return Error.throwIfNotObject(e),Object.entries(e).forEach(([e,t])=>{this.register(t,e)}),this}clear(){return this.#R.clear(),this}}class ViewportObserver{static#e=null;constructor(){if(ViewportObserver.#e)return ViewportObserver.#e;Object.freezeProp(ViewportObserver,"observers",new Set),Object.freeze(this),ViewportObserver.#e=this,Object.freeze(ViewportObserver)}removed(e,t,r={childList:!0,subtree:!0}){if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof HTMLElement))throw new TypeError("Invalid target element or selector.");const n=new MutationObserver(e=>{e.forEach(e=>{if(e.removedNodes.length>0)for(let r=0;r<e.removedNodes.length;r++){const n=e.removedNodes[r];n.nodeType===Node.ELEMENT_NODE&&t(n)}})});return n.observe(e,r),ViewportObserver.observers.add(n),()=>{n.disconnect(),ViewportObserver.observers.delete(n)}}added(e,t,r={childList:!0,subtree:!0}){if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof HTMLElement))throw new TypeError("Invalid target element or selector.");if("function"!=typeof t)throw new TypeError("Callback function is required.");const n=new MutationObserver(e=>{e.forEach(e=>{if(e.addedNodes.length>0)for(let r=0;r<e.addedNodes.length;r++){const n=e.addedNodes[r];n.nodeType===Node.ELEMENT_NODE&&t(n)}})});return n.observe(e,r),ViewportObserver.observers.add(n),()=>{n.disconnect(),ViewportObserver.observers.delete(n)}}attributes(e,t,r=[]){if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof HTMLElement))throw new TypeError("Invalid target element or selector.");if("function"!=typeof t)throw new TypeError("Callback function is required.");const n=Array.isArray(r)?r:[r],i=new MutationObserver(r=>{r.forEach(r=>{if("attributes"===r.type&&r.target.nodeType===Node.ELEMENT_NODE){const i=r.attributeName;(0===n.length||n.includes(i))&&t(e,i,r.oldValue,e.getAttribute(i))}})});return i.observe(e,{attributes:!0,attributeOldValue:!0,subtree:!1,childList:!1,characterData:!1}),ViewportObserver.observers.add(i),()=>{i.disconnect(),ViewportObserver.observers.delete(i)}}visible(e,t,r={},n=!0){if(!(e instanceof HTMLElement)&&"string"!=typeof e)throw new TypeError("Target must be an HTMLElement or selector string");if("function"!=typeof t)throw new TypeError("Callback function is required");const i=new IntersectionObserver(e=>{for(const r of e)r.isIntersecting&&r.target.nodeType===Node.ELEMENT_NODE&&(t(r.target),n&&i.unobserve(r.target))},r);return e instanceof HTMLElement?i.observe(e):"string"==typeof e&&document.querySelectorAll(e).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&i.observe(e)}),ViewportObserver.observers.add(i),()=>{i.disconnect(),ViewportObserver.observers.delete(i)}}disconnect(){for(const e of ViewportObserver.observers)e.disconnect();ViewportObserver.observers.clear()}}class ViewportService{static#e=null;constructor(){if(ViewportService.#e)return ViewportService.#e;Object.freezeProp(this,"observe",new ViewportObserver),ViewportService.#e=this}destroy(){ViewportService.#e=null}}const e=Application.createBuilder(),t=[{name:"router",service:RouterService,singleton:!0,global:!0},{name:"layout",service:LayoutService,singleton:!0,global:!0},{name:"global",service:GlobalService,singleton:!0,global:!0},{name:"cache",service:class CacheService{#t=new Map;constructor(){Object.freeze(this)}async expire(e){const t=e.handler;return this.#t.delete(e.key),null!==t?Promise.resolve(t()):Promise.resolve(null)}get count(){return this.#t.size}has(e){return Error.throwIfWhiteSpace(e,"key"),!!this.#t.has(e)&&null!==this.get(e)}set(e,t,r=null,n=null){if(null!=t){const i=new CacheEntry(e,t,r,n);this.#t.set(e,i)}return this}get(e){if(Error.throwIfWhiteSpace(e,"key"),this.#t.has(e)){const t=this.#t.get(e);return t.expired?(this.expire(t),null):t.value}return null}delete(e){return this.get(e),this.#t.delete(e),this}keys(){return this.#t.keys()}clear(){return this.#t.clear(),this}},singleton:!1,global:!0},{name:"event",service:EventService,singleton:!0,global:!0},{name:"state",service:StateService,singleton:!0,global:!0},{name:"storage",service:StorageService,singleton:!0,global:!0},{name:"reactive",service:ReactiveService,singleton:!0,global:!0},{name:"component",service:ComponentService,singleton:!0,global:!0},{name:"viewport",service:ViewportService,singleton:!0,global:!0}];for(const n of t)e.addService(n);const r=e.build();r.run(),Object.freezeProp(self,"app",r)}();