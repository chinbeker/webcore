!function(){"use strict";class ServiceManager{static#e=null;#t=new Map;#n=new Map;constructor(){if(ServiceManager.#e)return ServiceManager.#e;Object.freeze(this),ServiceManager.#e=this}#r(e){const t=e.depends.map(e=>this.get(e));return new e.service(...t)}get(e){if(!this.has(e))throw new Error(`Service '${e}' not registered`);const t=this.#t.get(e);return t.singleton?(this.#n.has(e)||this.#n.set(e,this.#r(t)),this.#n.get(e)):this.#r(t)}has(e){return this.#t.has(e)}serviceNames(){return Array.from(this.#t.keys())}register(e,t,n={}){if("string"==typeof e&&"object"==typeof n){const r={singleton:!1,depends:[],...n};this.#t.set(e,{service:t,...r})}return this}addSingleton(e,t,n=[]){return this.register(e,t,{singleton:!0,depends:n})}addTransient(e,t,n=[]){return this.register(e,t,{singleton:!1,depends:n})}destroy(){this.#n.forEach(e=>{"function"==typeof e.destroy&&e.destroy()}),this.#t.clear(),this.#n.clear()}}class Configuration{#i=new Map;constructor(){Object.freeze(this)}set(e,t){return this.#i.set(e,t),this}has(e){return this.#i.has(e)}get(e){return this.#i.get(e)}delete(e){return this.#i.has(e)&&this.#i.delete(e),this}clear(){return this.#i.clear(),this}}class ApplicationBuilder{#s=null;#a;#o;#c;#t=[];constructor(){this.#a=new Configuration,this.#o=new ServiceManager}setConfig(e,t){return this.#a.set(e,t),this}addService(e,t,n={}){return this.#o.register(e,t,n),this.#t.push(e),this}addSingleton(e,t,n=[]){return this.#o.addSingleton(e,t,n),this.#t.push(e),this}addTransient(e,t,n=[]){return this.#o.addTransient(e,t,n),this.#t.push(e),this}build(){const e=new Application(this.#a,this.#o,this.#c);for(const t of this.#t)e[t]=this.#o.get(t);return Object.freeze(e),e}}class Application{static#e=null;configuration=null;services=null;constructor(e,t){if(Application.#e)return Application.#e;this.configuration=e,this.services=t,Application.#e=this}static createBuilder(){return new ApplicationBuilder}getConfig(e){return this.configuration.get(e)}getService(e){return this.services.get(e)}hasService(e){return this.services.has(e)}cob(e=null){const t=Object.create(null);return"object"===this.typeOf(e)&&null!==Object.getPrototypeOf(e)&&Object.assign(t,e),t}cfn(e,t){return"function"!=typeof t?null:1==t.length?()=>{t(e)}:t.length>1?(...n)=>{t(e,...n)}:null}typeOf(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).replace(/^\[object (\S+)\]$/,"$1").toLowerCase()}createElement(e="div",t="",n=null){e="string"==typeof e&&e?e:"div";const r=document.createElement(e);if("object"===this.typeOf(n)){for(const[e,t]of Object.entries(n))r.setAttribute(e,t||"");n=null}return t&&(r.textContent=t),r}serviceNames(){return this.services.serviceNames()}run(){Object.hasOwn(this,"initial")&&this.initial.execute()}}class InitialService{static instance=null;default=null;open=null;loaded=null;executed=!1;constructor(){if(InitialService.instance)return InitialService.instance;self.addEventListener("DOMContentLoaded",()=>{try{"function"==typeof this.loaded&&this.loaded(),this.executed=!0,this.loaded=null}catch(e){return!1}},{once:!0}),Object.seal(this),InitialService.instance=this}execute(){if(!this.executed&&"function"==typeof this.default)try{"function"==typeof this.default&&this.default(),"function"==typeof this.load&&this.open(),this.executed=!0,this.default=null,this.loaded=null}catch(e){return!1}return!0}}class LayoutService{static#e=null;executed=!1;root=null;font=Object.create(null);constructor(){if(LayoutService.#e)return LayoutService.#e;this.executed=!1,this.root=document.documentElement,this.setupFontScaling(),this.setupUserExperience(),this.executed=!0,Object.freeze(this),LayoutService.#e=this}get fontSize(){return parseFloat(getComputedStyle(this.root).getPropertyValue("font-size"))}setupFontScaling(){if(this.executed)return!1;const e=this.root;if(e.classList.contains("dync"))return!1;const t=screen.orientation;this.font.base=28.57,this.font.initial=parseFloat(getComputedStyle(e).getPropertyValue("font-size"))||15.4;const n=()=>{0==screen.orientation.angle||180==screen.orientation.angle?this.root.classList.add("portrait"):this.root.classList.remove("portrait")},r=()=>{0==screen.orientation.angle||180==screen.orientation.angle?(this.root.style.fontSize=this.font.portrait,this.root.classList.add("portrait")):(this.root.style.fontSize=this.font.landscape,this.root.classList.remove("portrait"))},i=screen.width/this.font.initial<this.font.base||screen.height/this.font.initial<this.font.base;return!t.type.startsWith("p")||0!=t.angle&&180!=t.angle?!t.type.startsWith("l")||90!=t.angle&&270!=t.angle||(i?top.innerWidth>screen.width?(this.font.portrait=top.innerWidth/this.font.base+"px",this.font.landscape=top.innerWidth/screen.width*(screen.height/this.font.base)+"px",e.style.fontSize=this.font.landscape,t.onchange=r):(this.font.portrait=screen.height/this.font.base+"px",e.style.fontSize=this.font.portrait,t.onchange=n):t.onchange=n):(e.classList.add("portrait"),i?(this.font.portrait=top.innerWidth/this.font.base+"px",e.style.fontSize=this.font.portrait,top.innerWidth>screen.width?(this.font.landscape=top.innerWidth/screen.height*(screen.width/this.font.base)+"px",t.onchange=r):t.onchange=n):t.onchange=n),!0}setupUserExperience(){if(this.executed)return!1;this.root.classList.contains("ban")&&(this.root.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1));const e=function(){};return document.addEventListener("touchstart",e,{passive:!0}),window.onbeforeunload=()=>{document.removeEventListener("touchstart",e)},!0}}class OrientationChange{static#e=null;#l=[];#h=!1;constructor(){if(OrientationChange.#e)return OrientationChange.#e;Object.freeze(this),OrientationChange.#e=this}get length(){return this.#l.length}get count(){return this.#l.length}add(e){return this.#h||"function"!=typeof e||(this.remove(e),this.#l.push(e)),this}addBatch(e){if(!this.#h&&Array.isArray(e))for(const t of e)this.add(t);return this}has(e){return"function"==typeof e&&-1!==this.#l.indexOf(e)}async execute(){if(this.#h)return!1;this.#h=!0;for(const t of this.#l)try{await Promise.resolve(t())}catch(e){}return this.#h=!1,!0}remove(e){if(!this.#h&&"function"==typeof e){const t=this.#l.indexOf(e);if(-1!==t)return this.#l.splice(t,1),!0}return!1}removeAt(e){return!this.#h&&"number"==typeof e&&e>=0&&e<this.#l.length&&(this.#l.splice(e,1),!0)}clear(){return this.#l=[],!0}}class Orientation{static#e=null;#u=null;change=null;constructor(){if(Orientation.#e)return Orientation.#e;this.change=new OrientationChange,this.#u=top.matchMedia("(orientation: landscape)"),this.#u.onchange=()=>{this.change.execute()};const e=()=>{this.#u.matches?document.documentElement.classList.remove("portrait"):document.documentElement.classList.add("portrait")},t=screen.orientation;(document.documentElement.classList.contains("dync")||t.type.startsWith("p")&&(90==t.angle||270==t.angle)||t.type.startsWith("l")&&(0==t.angle||180==t.angle))&&this.change.add(e),e(),Object.freeze(this),Orientation.#e=this}get landscape(){return this.#u.matches}get portrait(){return!this.#u.matches}get matches(){return this.#u.matches?"landscape":"portrait"}destroy(){this.#u.onchange=null,this.change.clear(),Orientation.#e=null}}class ViewportService{static#e=null;orientation=null;constructor(){if(ViewportService.#e)return ViewportService.#e;this.orientation=new Orientation,Object.freeze(this),ViewportService.#e=this}get landscape(){return this.orientation.landscape}get portrait(){return this.orientation.portrait}destroy(){ViewportService.#e=null}}class RouterService{static#e=null;#f=null;#d=null;constructor(){if(RouterService.#e)return RouterService.#e;top.history.replaceState(!0,null,location.origin+location.pathname);const e=Object.create(null);e.top=e=>{e.preventDefault(),top.location.replace(e.currentTarget.dataset.href)},e.parent=e=>{e.preventDefault(),parent.location.replace(e.currentTarget.dataset.href)},e.blank=e=>{e.preventDefault(),self.open(e.currentTarget.dataset.href,"_blank")},e.assign=e=>{e.preventDefault(),location.assign(e.currentTarget.dataset.href)},e.replace=e=>{e.preventDefault(),location.replace(e.currentTarget.dataset.href)},this.#f=e,document.documentElement.classList.contains("webcore")&&top.addEventListener("DOMContentLoaded",()=>{this.init(),this.anchor(document.body)},{once:!0}),Object.freeze(this),RouterService.#e=this}init(){this.#f.frames=Object.create(null);const e=top.frames.length;for(let t=0;t<e;t++){const e=Object.create(null);e.frame=top.frames[t],e.assign=t=>{t.preventDefault(),e.frame.location.assign(t.currentTarget.dataset.href)},e.replace=t=>{t.preventDefault(),e.frame.location.replace(t.currentTarget.dataset.href)};const n=top.frames[t].name||"view";this.#f.frames[n]=e}}anchor(e){return e instanceof HTMLElement&&(0==e.childElementCount&&(e=e.parentElement),e.querySelectorAll("a[data-href]").forEach(e=>{const t=!!e.hasAttribute("data-target")&&e.dataset.target.trim(),n=!!e.hasAttribute("data-iframe")&&e.dataset.iframe.trim();if(t){if("top"===t)return e.onclick=this.#f.top,!0;if("parent"===t)return e.onclick=this.#f.parent,!0;if("blank"===t)return e.onclick=this.#f.blank,!0}return n&&Object.hasOwn(this.#f.frames,n)?t&&"self"===t?(e.onclick=this.#f.frames[n].replace,!0):(e.onclick=this.#f.frames[n].assign,!0):t&&"self"===t?(e.onclick=this.#f.replace,!0):(e.onclick=this.#f.assign,!0)}),!0)}}class nameService{static#e=null;#p=new Map;constructor(){if(nameService.#e)return nameService.#e;Object.freeze(this),nameService.#e=this}register(e,t={}){return!("string"!=typeof e||!(e=e.trim())||"object"!=typeof t)&&(null!==Object.getPrototypeOf(t)&&(t=Object.assign(Object.create(null),t)),this.remove(e),this.#p.set(e,t),!0)}has(e){return"string"==typeof e&&((e=e.trim())&&this.#p.has(e))}get(e,t=null){if("string"!=typeof e)throw new Error("The name name must be of string type.");if((e=e.trim())&&this.has(e)){const n=this.#p.get(e);if("object"==typeof n){if("string"!=typeof t)return n;if((t=t.trim())&&Object.hasOwn(n,t))return n[t]}}return null}remove(e){return!("string"!=typeof e||!(e=e.trim())||!this.has(e))&&(this.#p.delete(e),!0)}clear(){return this.#p.clear(),!0}}class EventBuilder{service=null;element=null;handlers=Object.create(null);options=Object.create(null);empty=Object.create(null);constructor(e,t){if(!(t instanceof HTMLElement))throw new Error("Event target must be an HTMLElement");this.service=e,this.element=t}on(e,t,n=null){if("string"!=typeof e)throw new Error("Event name must be a string");if("function"!=typeof t)throw new Error("Event handler must be a function");return this.handlers[e]=t,this.options[e]=n||this.empty,this}has(e){return"string"==typeof e&&Object.hasOwn(this.handlers,e)}get(e){return this.has(e)?this.handlers[e]:null}remove(e){return this.has(e)&&(this.handlers[e]=null,Reflect.deleteProperty(this.handlers,e),Object.hasOwn(this.options,e)&&(this.options[e]=null,Reflect.deleteProperty(this.options,e))),this}bind(){if(!this.service)throw new Error("EventService instance is missing");return this.service.register(this),this}once(e,t,n=null){return n||(n=this.empty),n.once=!0,this.on(e,t,n)}click(e,t){return this.on("click",e,t)}submit(e,t){return this.on("submit",e,t)}reset(e,t){return this.on("reset",e,t)}invalid(e,t){return this.on("invalid",e,t)}resize(e,t){return this.on("resize",e,t)}scroll(e,t){return this.on("scroll",e,t)}focus(e,t){return this.on("focus",e,t)}blur(e,t){return this.on("blur",e,t)}change(e,t){return this.on("change",e,t)}input(e,t){return this.on("input",e,t)}keydown(e,t){return this.on("keydown",e,t)}toggle(e,t){return this.on("toggle",e,t)}show(e,t){return this.on("show",e,t)}open(e,t){return this.on("open",e,t)}close(e,t){return this.on("close",e,t)}error(e,t){return this.on("error",e,t)}message(e,t){return this.on("message",e,t)}dblclick(e,t){return this.on("dblclick",e,t)}contextmenu(e,t){return this.on("contextmenu",e,t)}hover(e,t,n){return this.on("mouseenter",e,n),this.on("mouseleave",t,n),this}}class EventService{static#e=null;#f=new WeakMap;constructor(){if(EventService.#e)return EventService.#e;Object.freeze(this),EventService.#e=this}#g=e=>this.#m(e);target(e,t,n=10){if(!(e instanceof Event))return null;if(!e.target||!e.currentTarget)return null;let r=e.target;const i=e.currentTarget;if("string"!=typeof t)return r;if(!(t=t.trim().toUpperCase()))return r;if(r===i)return i.nodeName===t?r:null;if("string"==typeof t){let e=0;for(;e<n&&r!=i;){if(r.nodeName===t)return r;if(!r.parentElement)return null;r=r.parentElement,e++}}return null}has(e,t=null){if(!(e instanceof HTMLElement))return!1;return!!this.#f.has(e)&&("string"!=typeof t||Object.hasOwn(this.#f.get(e),t))}on(e,t,n,r){if(!(e instanceof HTMLElement))throw new Error("Event target must be an HTMLElement");if("string"!=typeof t)throw new Error("Event name must be a string");if("function"!=typeof n)throw new Error("Event handler must be a function");let i=null;try{return this.#f.has(e)?(i=this.#f.get(e),Object.hasOwn(i,t)||e.addEventListener(t,this.#g,r)):(i=Object.create(null),this.#f.set(e,i),e.addEventListener(t,this.#g,r)),i[t]=n,this}catch(s){return this}}select(e){return new EventBuilder(this,e)}register(e){try{if(e instanceof EventBuilder){this.#f.set(e.element,e.handlers);for(const t of Object.keys(e.handlers))e.element.addEventListener(t,this.#g,e.options[t])}}catch(t){return!1}}once(e,t,n,r={}){try{return r.once=!0,e.addEventListener(t,n,r),!0}catch(i){return!1}}#m(e){const t=e.type;let n=null;if(this.has(e.currentTarget,t)?n=this.#f.get(e.currentTarget)[t]:this.has(e.target,t)&&(n=this.#f.get(e.target)[t]),"function"==typeof n)try{return n(e)}catch(r){return!1}return!1}emit(e,t){if(this.has(e,t)){const r=this.#f.get(e)[t];try{return r()}catch(n){return!1}}return!1}remove(e,t=null){if(this.has(e)){let n=this.#f.get(e);if("string"==typeof t){if(!Object.hasOwn(n,t))return this;n[t]=null,Reflect.deleteProperty(n,t),e.removeEventListener(t,this.#g),0===Object.keys(n).length&&this.#f.delete(e)}else{for(const t of Object.keys(n))n[t]=null,e.removeEventListener(t,this.#g);n=null,this.#f.delete(e)}}return this}debounce(e,t=300,n=!1){let r=null;return function(...i){const s=this;r&&clearTimeout(r),n&&!r&&e.apply(s,i),r=setTimeout(()=>{r=null,n||e.apply(s,i)},t)}}throttle(e,t=300,n=!0){let r=null,i=0;return function(...s){const a=this,o=Date.now(),c=t-(o-i);r&&(clearTimeout(r),r=null),c<=0?(e.apply(a,s),i=o):n&&!r&&(r=setTimeout(()=>{e.apply(a,s),i=Date.now(),r=null},c))}}destroy(){this.#f=new WeakMap}}const e=Application.createBuilder(),t=[{name:"initial",service:InitialService},{name:"layout",service:LayoutService},{name:"viewport",service:ViewportService},{name:"router",service:RouterService},{name:"view",service:nameService},{name:"event",service:EventService}];for(const r of t)e.addSingleton(r.name,r.service);const n=e.build();n.run(),self.app=n}();